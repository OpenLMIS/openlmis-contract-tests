version: "2"
services:

  requisition:
    image: openlmis/requisition:5.1.0-SNAPSHOT
    mem_limit: 512m
    env_file: .env
    environment:
      JAVA_OPTS: '-Xmx256m -Dlogging.config=/logback.xml'
      spring_profiles_active: demo-data,refresh-db
    volumes:
      - './logback.xml:/logback.xml'
    depends_on: [log]

  reference-ui:
    image: openlmis/reference-ui:5.0.4-SNAPSHOT
    mem_limit: 512m
    env_file: .env

  notification:
    image: openlmis/notification:3.0.4-SNAPSHOT
    mem_limit: 512m
    env_file: .env
    environment:
      JAVA_OPTS: '-Xmx256m -Dlogging.config=/logback.xml'
    volumes:
      - './logback.xml:/logback.xml'
    depends_on: [log]

  fulfillment:
    mem_limit: 512m
    image: openlmis/fulfillment:6.0.1-SNAPSHOT
    env_file: .env
    environment:
      JAVA_OPTS: '-Xmx256m -Dlogging.config=/logback.xml -Dflyway.locations=classpath:db/migration,filesystem:/demo-data'
    volumes:
      - './logback.xml:/logback.xml'
    depends_on: [log]

  cce:
    mem_limit: 512m
    image: openlmis/cce:1.0.0-SNAPSHOT
    env_file: .env
    environment:
      JAVA_OPTS: '-Xmx256m -Dlogging.config=/logback.xml'
      spring_profiles_active: demo-data,refresh-db
    volumes:
      - './logback.xml:/logback.xml'
    depends_on: [log]

  stockmanagement:
    mem_limit: 512m
    image: openlmis/stockmanagement:2.0.0-SNAPSHOT
    env_file: .env
    environment:
      JAVA_OPTS: '-Xmx256m -Dlogging.config=/logback.xml -Dflyway.locations=classpath:db/migration,filesystem:/demo-data'
    volumes:
      - './logback.xml:/logback.xml'
    depends_on: [log]

  contract_tests:
    mem_limit: 1024m
    image: openlmis/dev:3
    environment:
      GRADLE_OPTS: '-Xmx256m'
    env_file: .env
    volumes:
      - '.:/app'
      - 'gradlecache:/gradle'
    links:
    - db
    - log
    - nginx
    - consul
    - auth
    - requisition
    - reference-ui
    - referencedata
    - notification
    - fulfillment
    - cce
    - stockmanagement

    entrypoint:
      - 'gradle'
      - 'clean'
      - 'waitFor'
      - '-Pcontainers=
        ${BASE_URL}/auth
        ,${BASE_URL}/requisition
        ,${BASE_URL}/referencedata
        ,${BASE_URL}/stockmanagement
        ,${BASE_URL}/fulfillment'
      - 'cucumber'
      - '-Ptags=@RequisitionTests'
      - '--stacktrace'
#the programs end point has been removed from requisition service
#please replace the @admin with new test cases
#      - '-Ptags=@notImplementedYet'

volumes:
  gradlecache:
    external: false
